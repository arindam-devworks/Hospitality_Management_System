<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login | Hospitality System</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="auth.css" />
  </head>
  <body>
    <div class="auth-container">
      <div class="auth-left">
        <div class="auth-left-content">
          <h1>Welcome Back!</h1>
          <p>
            Login to access your personalized dashboard and manage your
            hospitality services.
          </p>
          <div class="auth-features">
            <div class="feature">
              <i class="fas fa-bolt"></i>
              <span>Quick Booking Management</span>
            </div>
            <div class="feature">
              <i class="fas fa-chart-line"></i>
              <span>Real-time Analytics</span>
            </div>
            <div class="feature">
              <i class="fas fa-shield-alt"></i>
              <span>Secure Transactions</span>
            </div>
          </div>
        </div>
        <div class="auth-left-pattern">
          <div class="pattern-circle circle-1"></div>
          <div class="pattern-circle circle-2"></div>
          <div class="pattern-circle circle-3"></div>
        </div>
      </div>

      <div class="auth-right">
        <div class="auth-form-container">
          <div class="auth-header">
            <h2>Login to Your Account</h2>
            <p>Don't have an account? <a href="signup.html">Sign up</a></p>
          </div>

          <div class="social-login">
            <button class="social-btn google" id="google-login-btn">
              <i class="fab fa-google"></i> Continue with Google
            </button>
            <button class="social-btn facebook" id="facebook-login-btn">
              <i class="fab fa-facebook-f"></i> Continue with Facebook
            </button>
          </div>

          <div class="divider">
            <span>or</span>
          </div>

          <form class="auth-form" id="loginForm">
            <div class="form-group">
              <label for="email">Email Address</label>
              <div class="input-with-icon">
                <i class="fas fa-envelope"></i>
                <input
                  type="email"
                  id="email"
                  placeholder="Enter your email"
                  required
                />
              </div>
            </div>

            <div class="form-group">
              <label for="password">Password</label>
              <div class="input-with-icon">
                <i class="fas fa-lock"></i>
                <input
                  type="password"
                  id="password"
                  placeholder="Enter your password"
                  required
                />
                <i class="fas fa-eye toggle-password" id="togglePassword"></i>
              </div>
              <div class="form-options">
                <label class="remember-me">
                  <input type="checkbox" /> Remember me
                </label>
                <a href="#" class="forgot-password" id="forgot-password-link">Forgot password?</a>
              </div>
            </div>

            <button type="submit" class="auth-btn">Login</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal" id="forgot-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.4);z-index:2000;align-items:center;justify-content:center;">
      <div class="modal-content" style="background:#fff;padding:30px 20px;border-radius:10px;max-width:350px;width:90%;margin:auto;position:relative;">
        <button id="close-forgot" style="position:absolute;top:10px;right:15px;background:none;border:none;font-size:1.5rem;cursor:pointer;">&times;</button>
        <h2 style="margin-bottom:15px;">Reset Password</h2>
        <form id="forgotForm">
          <div class="form-group">
            <label for="forgot-email">Enter your email</label>
            <input type="email" id="forgot-email" class="form-control" placeholder="Email address" required style="width:100%;padding:10px;margin-bottom:15px;">
          </div>
          <button type="submit" class="auth-btn" style="width:100%;">Send Reset Link</button>
        </form>
        <div id="forgot-message" style="margin-top:10px;color:var(--primary);"></div>
      </div>
    </div>

    <script src="auth.js"></script>
    <script>
    // Forgot password modal logic
    const forgotLink = document.getElementById('forgot-password-link');
    const forgotModal = document.getElementById('forgot-modal');
    const closeForgot = document.getElementById('close-forgot');
    const forgotForm = document.getElementById('forgotForm');
    const forgotMessage = document.getElementById('forgot-message');
    if (forgotLink && forgotModal && closeForgot && forgotForm) {
      forgotLink.onclick = function(e) {
        e.preventDefault();
        forgotModal.style.display = 'flex';
        forgotMessage.textContent = '';
        forgotForm.reset();
      };
      closeForgot.onclick = function() {
        forgotModal.style.display = 'none';
      };
      window.onclick = function(e) {
        if (e.target === forgotModal) forgotModal.style.display = 'none';
      };
      forgotForm.onsubmit = async function(e) {
        e.preventDefault();
        const email = document.getElementById('forgot-email').value;
        forgotMessage.textContent = 'Sending reset link...';
        try {
          const res = await fetch('http://localhost:3000/api/forgot-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
          });
          const data = await res.json();
          if (data.success) {
            forgotMessage.textContent = 'Reset link sent! Check your email.';
          } else {
            forgotMessage.textContent = data.message || 'Failed to send reset link.';
          }
        } catch (err) {
          forgotMessage.textContent = 'Error sending reset link.';
        }
      };
    }

    // Google/Facebook OAuth login
    function openOAuthPopup(url) {
      const w = 500, h = 600;
      const left = (screen.width - w) / 2;
      const top = (screen.height - h) / 2;
      const popup = window.open(url, 'oauthPopup', `width=${w},height=${h},left=${left},top=${top}`);
      window.addEventListener('message', function handler(e) {
        if (e.data && e.data.user) {
          try {
            const user = JSON.parse(e.data.user);
            localStorage.setItem('user', JSON.stringify(user));
            window.location.href = './homepage.html';
          } catch (err) {}
          window.removeEventListener('message', handler);
          if (popup) popup.close();
        }
      });
    }
    document.getElementById('google-login-btn').onclick = function(e) {
      e.preventDefault();
      openOAuthPopup('http://localhost:3000/auth/google');
    };
    document.getElementById('facebook-login-btn').onclick = function(e) {
      e.preventDefault();
      openOAuthPopup('http://localhost:3000/auth/facebook');
    };
    </script>
  </body>
</html>
